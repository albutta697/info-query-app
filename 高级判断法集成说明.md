# ğŸš€ é«˜çº§åˆ¤æ–­æ³•é›†æˆè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

åŸºäº MCP æµè§ˆå™¨æµ‹è¯•ä¸­å‘ç°çš„ç²¾ç¡®åˆ¤æ–­æ–¹æ³•ï¼Œæˆ‘å·²ç»ä¸ºä½ çš„ä¿¡æ¯æŸ¥è¯¢åº”ç”¨æˆåŠŸé›†æˆäº†**é«˜çº§åˆ¤æ–­æ³•**ã€‚è¿™å¥—æ–°çš„åˆ¤æ–­ç³»ç»Ÿå¤§å¤§æé«˜äº†é¡µé¢çŠ¶æ€æ£€æµ‹çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚

## ğŸ¯ ä¸»è¦æ”¹è¿›

### 1. **æ•°æ®å˜åŒ–ç²¾ç¡®åˆ¤æ–­**
- **åŸç†**ï¼šåŸºäº"å…±XXXæ¡æ•°æ®"æ–‡æœ¬çš„å˜åŒ–æ¥åˆ¤æ–­æŸ¥è¯¢å®Œæˆ
- **ä¼˜åŠ¿**ï¼šæ¯”è¡¨æ ¼è¡Œæ•°å˜åŒ–æ›´å‡†ç¡®ï¼Œèƒ½æ£€æµ‹åˆ°æ•°æ®æ€»æ•°çš„å˜åŒ–
- **åº”ç”¨**ï¼šæŸ¥è¯¢æ‰§è¡Œã€ç¿»é¡µæ“ä½œã€æ•°æ®åˆ·æ–°æ£€æµ‹

### 2. **é«˜çº§æœç´¢çŠ¶æ€æ™ºèƒ½æ£€æµ‹**
- **åŸç†**ï¼šæ£€æŸ¥ SSNã€cityã€stã€phoneã€emailã€zip ç­‰é«˜çº§å­—æ®µæ˜¯å¦å¯è§
- **ä¼˜åŠ¿**ï¼šæ¯”ç®€å•çš„å…ƒç´ å­˜åœ¨åˆ¤æ–­æ›´å¯é 
- **è¯„åˆ†ç³»ç»Ÿ**ï¼šæä¾›æ‰©å±•è¯„åˆ† (0-100%) æ¥é‡åŒ–å±•å¼€ç¨‹åº¦

### 3. **åˆ†é¡µè®¾ç½®ç²¾ç¡®è¯†åˆ«**
- **åŸç†**ï¼šé€šè¿‡"XX / é¡µ"æ–‡æœ¬è¿›è¡Œå‡†ç¡®åŒ¹é…
- **ä¼˜åŠ¿**ï¼šé¿å…äº†å¤æ‚çš„DOMé€‰æ‹©å™¨ä¾èµ–
- **æ”¯æŒ**ï¼šè‡ªåŠ¨è¯†åˆ«å½“å‰åˆ†é¡µè®¾ç½®å¹¶éªŒè¯æ˜¯å¦ä¸º100/é¡µ

### 4. **ç»¼åˆé¡µé¢å‡†å¤‡çŠ¶æ€è¯„ä¼°**
- **å¤šç»´åº¦æ£€æµ‹**ï¼šç»“åˆæ•°æ®ç»Ÿè®¡ã€é«˜çº§æœç´¢ã€åˆ†é¡µè®¾ç½®ã€è¡¨æ ¼å†…å®¹ç­‰å¤šä¸ªæŒ‡æ ‡
- **è¯„åˆ†æœºåˆ¶**ï¼šæä¾›0-100%çš„å‡†å¤‡åº¦è¯„åˆ†
- **æƒé‡åˆ†é…**ï¼šæ•°æ®æ€»æ•°(30%) + æ•°æ®è¡¨æ ¼(20%) + é«˜çº§æœç´¢(25%) + åˆ†é¡µè®¾ç½®(15%) + å†…å®¹æœ‰æ•ˆæ€§(10%)

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. `src/renderer/advanced-detector.js`
**æ ¸å¿ƒé«˜çº§æ£€æµ‹å™¨ç±»**
- `AdvancedDetector` - ä¸»æ£€æµ‹å™¨ç±»
- `detectDataChange()` - æ•°æ®å˜åŒ–æ£€æµ‹
- `checkAdvancedSearchExpanded()` - é«˜çº§æœç´¢çŠ¶æ€æ£€æµ‹
- `checkPageSizeIs100()` - åˆ†é¡µè®¾ç½®æ£€æµ‹
- `checkPageReadiness()` - ç»¼åˆé¡µé¢å‡†å¤‡çŠ¶æ€æ£€æµ‹
- `waitForQueryComplete()` - åŸºäºæ•°æ®å˜åŒ–çš„æŸ¥è¯¢ç­‰å¾…
- `waitForPageChange()` - ç¿»é¡µæ“ä½œç­‰å¾…

### 2. `src/renderer/test-advanced-detector.js`
**æµ‹è¯•å’Œä½¿ç”¨ç¤ºä¾‹**
- `AdvancedDetectorTester` - å®Œæ•´æµ‹è¯•å¥—ä»¶
- `demonstrateUsage()` - ä½¿ç”¨ç¤ºä¾‹å‡½æ•°
- åŒ…å«è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’Œè¯„ä¼°æœºåˆ¶

## ğŸ”§ é›†æˆè¯¦æƒ…

### 1. **BrowserManager æ›´æ–°**

```javascript
// æ–°å¢é«˜çº§æ£€æµ‹å™¨å®ä¾‹
this.advancedDetector = new AdvancedDetector();

// æ›´æ–°ç°æœ‰æ–¹æ³•ä½¿ç”¨é«˜çº§æ£€æµ‹
async checkAdvancedSearchExpanded(page) {
    const result = await this.advancedDetector.checkAdvancedSearchExpanded(page);
    return result.isExpanded;
}

async checkPageSizeIs100(page) {
    const result = await this.advancedDetector.checkPageSizeIs100(page);
    return result.is100PerPage;
}

async checkDataRefreshSuccess(page) {
    const readiness = await this.advancedDetector.checkPageReadiness(page);
    return {
        success: readiness.isReady,
        score: readiness.score,
        issues: readiness.issues
    };
}
```

### 2. **Utils å¢å¼º**

```javascript
// æ–°å¢é«˜çº§ç­‰å¾…æ–¹æ³•
async function waitForTableContentChangeOrAppearAdvanced(page, oldRows, timeout) {
    // è‡ªåŠ¨åˆ¤æ–­æ˜¯æŸ¥è¯¢è¿˜æ˜¯ç¿»é¡µæ“ä½œ
    // ä½¿ç”¨å¯¹åº”çš„é«˜çº§æ£€æµ‹æ–¹æ³•
    // å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°åŸæœ‰æ–¹æ³•
}
```

## ğŸ® ä½¿ç”¨æ–¹æ³•

### 1. **åŸºæœ¬é¡µé¢çŠ¶æ€æ£€æŸ¥**

```javascript
// åœ¨ BrowserManager ä¸­
const refreshStatus = await browserManager.checkDataRefreshSuccess(page);
console.log(`é¡µé¢å‡†å¤‡çŠ¶æ€: ${refreshStatus.success ? 'å°±ç»ª' : 'æœªå°±ç»ª'} (${refreshStatus.score}%)`);

if (!refreshStatus.success) {
    console.log('é—®é¢˜:', refreshStatus.issues);
}
```

### 2. **ç­‰å¾…æŸ¥è¯¢å®Œæˆ**

```javascript
// ä½¿ç”¨é«˜çº§æ£€æµ‹å™¨ç›´æ¥ç­‰å¾…
const queryResult = await browserManager.advancedDetector.waitForQueryComplete(page, 15000);
if (queryResult.success) {
    console.log('æŸ¥è¯¢å®Œæˆ:', queryResult.finalState);
} else {
    console.log('æŸ¥è¯¢ç­‰å¾…å¤±è´¥:', queryResult.reason);
}
```

### 3. **ç¿»é¡µæ“ä½œç­‰å¾…**

```javascript
// ç‚¹å‡»ä¸‹ä¸€é¡µåç­‰å¾…
await page.click('.next-page-button');
const pageChangeResult = await browserManager.advancedDetector.waitForPageChange(page, 2, 10000);
if (pageChangeResult.success) {
    console.log(`æˆåŠŸä»ç¬¬${pageChangeResult.fromPage}é¡µç¿»åˆ°ç¬¬${pageChangeResult.toPage}é¡µ`);
}
```

### 4. **å…·ä½“é…ç½®æ£€æŸ¥**

```javascript
// æ£€æŸ¥é«˜çº§æœç´¢çŠ¶æ€
const advancedResult = await browserManager.advancedDetector.checkAdvancedSearchExpanded(page);
console.log(`é«˜çº§æœç´¢å±•å¼€çŠ¶æ€: ${advancedResult.isExpanded} (è¯„åˆ†: ${Math.round(advancedResult.expansionScore * 100)}%)`);
console.log('æ‰¾åˆ°çš„å­—æ®µ:', advancedResult.foundFieldDetails);

// æ£€æŸ¥åˆ†é¡µè®¾ç½®
const pageSizeResult = await browserManager.advancedDetector.checkPageSizeIs100(page);
console.log(`åˆ†é¡µè®¾ç½®: ${pageSizeResult.currentPageSize}/é¡µ`);
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### è¿è¡Œå®Œæ•´æµ‹è¯•

```javascript
const { AdvancedDetectorTester } = require('./src/renderer/test-advanced-detector');

// åœ¨æœ‰å¯ç”¨é¡µé¢çš„æƒ…å†µä¸‹è¿è¡Œæµ‹è¯•
const tester = new AdvancedDetectorTester();
const results = await tester.runTests(page);

// æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
console.log('æµ‹è¯•ç»“æœ:', results);
```

### å¿«é€ŸçŠ¶æ€æ£€æŸ¥

```javascript
const { demonstrateUsage } = require('./src/renderer/test-advanced-detector');
await demonstrateUsage(page);
```

## ğŸ“Š è¯„åˆ†æ ‡å‡†

### é¡µé¢å‡†å¤‡åº¦è¯„åˆ†
- **90-100%**: ä¼˜ç§€ - æ‰€æœ‰æ£€æµ‹é¡¹éƒ½é€šè¿‡
- **80-89%**: è‰¯å¥½ - ä¸»è¦æ£€æµ‹é¡¹é€šè¿‡ï¼Œå°‘æ•°é¡¹ç›®å¾…ä¼˜åŒ–
- **70-79%**: å¯æ¥å— - åŸºæœ¬åŠŸèƒ½æ­£å¸¸ï¼Œæœ‰æ”¹è¿›ç©ºé—´
- **60-69%**: éœ€è¦å…³æ³¨ - éƒ¨åˆ†é‡è¦åŠŸèƒ½ç¼ºå¤±
- **<60%**: éœ€è¦ä¿®å¤ - å¤šä¸ªå…³é”®åŠŸèƒ½æœªå°±ç»ª

### å„é¡¹æ£€æµ‹è¯„åˆ†æƒé‡
- **æ•°æ®æ€»æ•°æ˜¾ç¤º** (30%): æœ€é‡è¦çš„æŒ‡æ ‡
- **é«˜çº§æœç´¢å±•å¼€** (25%): åŠŸèƒ½å®Œæ•´æ€§æŒ‡æ ‡  
- **æ•°æ®è¡¨æ ¼å­˜åœ¨** (20%): åŸºç¡€åŠŸèƒ½æŒ‡æ ‡
- **åˆ†é¡µè®¾ç½®æ­£ç¡®** (15%): æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡
- **å†…å®¹æœ‰æ•ˆæ€§** (10%): æ•°æ®è´¨é‡æŒ‡æ ‡

## ğŸ”„ å…¼å®¹æ€§è®¾è®¡

### å‘åå…¼å®¹
- æ‰€æœ‰åŸæœ‰æ–¹æ³•ä¿æŒå¯ç”¨
- é«˜çº§æ£€æµ‹å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°åŸæœ‰é€»è¾‘
- æ¸è¿›å¼é›†æˆï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### é”™è¯¯å¤„ç†
- æ¯ä¸ªé«˜çº§æ£€æµ‹æ–¹æ³•éƒ½æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’ŒåŸå› åˆ†æ
- è‡ªåŠ¨é‡è¯•å’Œé™çº§æœºåˆ¶

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. **æ—¥å¸¸ä½¿ç”¨å»ºè®®**
- ä½¿ç”¨ `checkDataRefreshSuccess()` è¿›è¡Œå¸¸è§„é¡µé¢çŠ¶æ€æ£€æŸ¥
- å¯¹äºæŸ¥è¯¢æ“ä½œï¼Œä¼˜å…ˆä½¿ç”¨ `waitForQueryComplete()`
- ç¿»é¡µæ“ä½œä½¿ç”¨ `waitForPageChange()` æé«˜å‡†ç¡®æ€§

### 2. **æ€§èƒ½ä¼˜åŒ–**
- é«˜çº§æ£€æµ‹å™¨æœ‰å†…ç½®çš„é˜²æŠ–å’Œä¼˜åŒ–æœºåˆ¶
- æ£€æµ‹é—´éš”å·²è°ƒä¼˜ï¼Œå¹³è¡¡å‡†ç¡®æ€§å’Œæ€§èƒ½
- æ”¯æŒå¹¶è¡Œæ£€æµ‹å¤šä¸ªæŒ‡æ ‡

### 3. **ç›‘æ§å»ºè®®**
- å®šæœŸè¿è¡Œæµ‹è¯•å¥—ä»¶ç›‘æ§ç³»ç»ŸçŠ¶æ€
- å…³æ³¨è¯„åˆ†å˜åŒ–è¶‹åŠ¿
- è®°å½•æ£€æµ‹å¤±è´¥çš„åŸå› è¿›è¡Œä¼˜åŒ–

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. **èµ„æºæ¸…ç†**
```javascript
// åº”ç”¨å…³é—­æ—¶æ¸…ç†èµ„æº
await browserManager.cleanupBeforeClose(); // å·²è‡ªåŠ¨åŒ…å«é«˜çº§æ£€æµ‹å™¨æ¸…ç†
```

### 2. **å–æ¶ˆæ“ä½œæ”¯æŒ**
- æ‰€æœ‰é«˜çº§æ£€æµ‹æ–¹æ³•éƒ½æ”¯æŒå…¨å±€å–æ¶ˆæ ‡å¿— `window.globalShouldStop`
- ä¸ç°æœ‰å–æ¶ˆæœºåˆ¶å®Œå…¨å…¼å®¹

### 3. **æ—¥å¿—ç®¡ç†**
- é«˜çº§æ£€æµ‹å™¨ä½¿ç”¨ `[é«˜çº§æ£€æµ‹]` ã€`[é«˜çº§åˆ¤æ–­]`ã€`[é«˜çº§ç­‰å¾…]` å‰ç¼€
- ä¾¿äºåœ¨æ—¥å¿—ä¸­è¯†åˆ«å’Œè¿‡æ»¤

## ğŸ”® æœªæ¥æ‰©å±•

è¿™å¥—é«˜çº§åˆ¤æ–­æ³•ä¸ºä»¥åçš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†åŸºç¡€ï¼š

1. **æ›´å¤šæ£€æµ‹ç»´åº¦**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„é¡µé¢çŠ¶æ€æ£€æµ‹é¡¹
2. **æ™ºèƒ½å­¦ä¹ **ï¼šå¯ä»¥åŸºäºå†å²æ•°æ®ä¼˜åŒ–æ£€æµ‹é˜ˆå€¼
3. **æ€§èƒ½ç›‘æ§**ï¼šå¯ä»¥æ‰©å±•ä¸ºå®Œæ•´çš„é¡µé¢æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
4. **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šå¯ä»¥é›†æˆåˆ°è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ä¸­

## âœ… é›†æˆå®Œæˆæ¸…å•

- [x] åˆ›å»ºé«˜çº§æ£€æµ‹å™¨æ ¸å¿ƒç±» (`advanced-detector.js`)
- [x] æ›´æ–° BrowserManager é›†æˆé«˜çº§æ£€æµ‹å™¨
- [x] æ›´æ–°ç°æœ‰æ£€æµ‹æ–¹æ³•ä½¿ç”¨é«˜çº§é€»è¾‘
- [x] æ·»åŠ é«˜çº§ç­‰å¾…æ–¹æ³•åˆ° utils
- [x] åˆ›å»ºå®Œæ•´æµ‹è¯•å¥—ä»¶å’Œä½¿ç”¨ç¤ºä¾‹
- [x] å®ç°å‘åå…¼å®¹å’Œé”™è¯¯å¤„ç†
- [x] æ·»åŠ èµ„æºæ¸…ç†æœºåˆ¶
- [x] æ”¯æŒå–æ¶ˆæ“ä½œ
- [x] æä¾›è¯¦ç»†æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

ä½ çš„ä¿¡æ¯æŸ¥è¯¢åº”ç”¨ç°åœ¨å·²ç»æˆåŠŸé›†æˆäº†åŸºäº MCP æµ‹è¯•å‘ç°çš„é«˜çº§åˆ¤æ–­æ³•ï¼è¿™å°†å¤§å¤§æé«˜åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚ğŸ‰ 