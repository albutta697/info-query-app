# 多页面查询取消功能测试指南

## 测试目的
验证在多页面查询场景下，取消按钮能够立即停止查询操作，不再有长时间等待的问题。

## 测试准备
1. 确保应用已正常启动
2. 确保能够访问目标查询网站
3. 准备一个会产生多页结果的查询条件（例如：只填写姓氏，不填写具体地址）

## 测试步骤

### 测试用例1：普通查询多页面取消
1. 启动应用
2. 在左侧表单中：
   - FirstName: 填写常见姓名如 "John"
   - LastName: 填写常见姓氏如 "Smith" 
   - 其他字段留空（这样会产生大量多页结果）
3. 点击"开始查询"按钮
4. 等待查询开始并显示"正在处理第 X 页结果..."的提示
5. **立即点击"取消查询"按钮**
6. 观察取消响应时间

**预期结果：**
- 取消操作应在1-2秒内生效
- 控制台应显示"等待表格变化被立即取消"或类似消息
- 按钮文本应立即从"取消查询"变回"开始查询"
- 状态应显示"查询已取消"

### 测试用例2：高级查询多页面取消
1. 切换到"高级查询"标签
2. 在高级查询表单中：
   - FirstName: "Michael"
   - LastName: "Johnson"
   - 其他字段留空
3. 点击"开始查询"按钮
4. 等待显示多页查询进度
5. **在处理第2页或第3页时立即点击"取消查询"**
6. 观察取消响应时间

**预期结果：**
- 高级查询的取消操作也应在1-2秒内生效
- 控制台应显示"高级查询等待表格变化被立即取消"
- 高级查询按钮应恢复为"开始查询"状态

### 测试用例3：网络缓慢情况下的取消
1. 如果可能，模拟网络缓慢的情况
2. 执行会产生多页结果的查询
3. 在网络响应缓慢时点击取消
4. 验证即使在网络缓慢的情况下，取消操作仍能快速响应

## 关键改进点验证

### 1. 快速取消检查
- 验证控制台中出现"每10ms检查一次"的快速取消检查
- 确认没有长时间的阻塞等待

### 2. Promise.race机制
- 查看控制台日志，确认使用了Promise.race机制
- 验证取消信号能够立即胜出，中断等待过程

### 3. 页面强制关闭
- 在多标签页查询时，验证非主页面能够被快速关闭
- 确认即使页面响应缓慢，关闭操作也有1秒超时保护

## 性能基准
- **原问题：** 多页面查询取消可能需要10-30秒才能响应
- **目标改进：** 取消操作应在1-3秒内生效
- **最佳情况：** 取消操作在0.5-1秒内生效

## 故障排除
如果取消功能仍然缓慢：
1. 检查控制台是否有错误信息
2. 确认 `window.globalShouldStop` 标志是否正确设置
3. 验证 `waitForTableContentChangeOrAppear` 函数是否使用了新的Promise.race机制
4. 检查网络状况是否影响页面响应

## 验证成功标准
✅ 取消操作在3秒内完成  
✅ 控制台显示"立即取消"相关日志  
✅ 按钮状态正确恢复  
✅ 没有长时间阻塞等待  
✅ 多页面查询能够被及时中断  

## 注意事项
- 测试时注意观察控制台日志输出
- 如果网站响应极慢，可能仍需要等待网络超时
- 确保测试在不同网络条件下进行 